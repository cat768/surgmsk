<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Surgery &amp; Musculoskeletal Module</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
</head>
<body>
  <header>
    <h1>Surgery &amp; Musculoskeletal Syllabus</h1>
  </header>
  <main id="content">Loading syllabus...</main>
  <script>
    fetch('syllabus.yaml')
      .then(res => res.text())
      .then(text => {
        const data = jsyaml.load(text);
        const root = document.getElementById('content');
        root.innerHTML = '';

        function createList(items) {
          const ul = document.createElement('ul');
          items.forEach(item => {
            const li = document.createElement('li');
            if (typeof item === 'string') {
              li.textContent = item;
            } else if (item.topic) {
              li.innerHTML = `<strong>${item.topic}</strong> <em>${item.depth}</em>: ${item.notes}`;
            }
            ul.appendChild(li);
          });
          return ul;
        }

        // competency levels
        if (data.competency_levels) {
          const h2 = document.createElement('h2');
          h2.textContent = 'Competency Levels';
          root.appendChild(h2);

          const table = document.createElement('table');
          const headerRow = document.createElement('tr');
          headerRow.innerHTML = '<th>Level</th><th>Definition</th><th>Examples</th>';
          table.appendChild(headerRow);
          Object.entries(data.competency_levels).forEach(([level, info]) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${level}</td><td>${info.def}</td><td>${info.examples.join(', ')}</td>`;
            table.appendChild(tr);
          });
          root.appendChild(table);
        }

        // MSK topics
        if (data.msk_topics) {
          const h2 = document.createElement('h2');
          h2.textContent = 'MSK Topics';
          root.appendChild(h2);
          root.appendChild(createList(data.msk_topics));
        }

        if (data.surgery) {
          const h2 = document.createElement('h2');
          h2.textContent = 'Surgery';
          root.appendChild(h2);

          const p = document.createElement('p');
          p.textContent = data.surgery.overview;
          root.appendChild(p);

          if (data.surgery.outcomes_competencies) {
            const h3 = document.createElement('h3');
            h3.textContent = 'Outcomes & Competencies';
            root.appendChild(h3);
            root.appendChild(createList(data.surgery.outcomes_competencies));
          }

          if (data.surgery.core_topics) {
            const h3 = document.createElement('h3');
            h3.textContent = 'Core Topics';
            root.appendChild(h3);
            Object.entries(data.surgery.core_topics).forEach(([section, list]) => {
              const h4 = document.createElement('h4');
              h4.textContent = section.replace(/_/g, ' ');
              root.appendChild(h4);
              root.appendChild(createList(list));
            });
          }

          if (data.surgery.key_presentations) {
            const h3 = document.createElement('h3');
            h3.textContent = 'Key Presentations';
            root.appendChild(h3);
            Object.entries(data.surgery.key_presentations).forEach(([section, list]) => {
              const h4 = document.createElement('h4');
              h4.textContent = section.replace(/_/g, ' ');
              root.appendChild(h4);
              root.appendChild(createList(list));
            });
          }
        }
      })
      .catch(err => {
        document.getElementById('content').textContent = 'Failed to load syllabus.';
        console.error(err);
      });
  </script>
</body>
</html>
